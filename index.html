<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>オセロゲーム</title>
<style>
  body {
    display: flex;
    justify-content: center;
    padding-top: 30px;
    background: #f0f0f0;
    font-family: sans-serif;
  }
  #board {
    display: grid;
    grid-template-columns: repeat(8, 60px);
    grid-template-rows: repeat(8, 60px);
    background: #2e8b57; /* 緑 */
    border: 5px solid black;
    gap: 2px;
  }
  .cell {
    width: 60px;
    height: 60px;
    background: #2e8b57;
    border: 1px solid black;
    position: relative;
    cursor: pointer;
  }
  .stone {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    position: absolute;
    top: 6px;
    left: 6px;
    transition: 0.2s;
  }
  .black { background: black; }
  .white { background: white; }
</style>
</head>
<body>

<div id="board"></div>

<script>
// ----- 初期設定 -----
const boardSize = 8;
let board = [];
let currentPlayer = "black"; // 黒からスタート

// 空ボード作成
for (let i = 0; i < boardSize; i++) {
  board[i] = Array(boardSize).fill(null);
}

// 初期配置
board[3][3] = "white";
board[3][4] = "black";
board[4][3] = "black";
board[4][4] = "white";

const boardDiv = document.getElementById("board");

// ボード描画
function drawBoard() {
  boardDiv.innerHTML = "";
  for (let y = 0; y < boardSize; y++) {
    for (let x = 0; x < boardSize; x++) {
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.dataset.x = x;
      cell.dataset.y = y;

      if (board[y][x]) {
        const stone = document.createElement("div");
        stone.className = "stone " + board[y][x];
        cell.appendChild(stone);
      }

      cell.onclick = () => handleClick(x, y);
      boardDiv.appendChild(cell);
    }
  }
}

drawBoard();

// 8方向
const directions = [
  [1, 0], [-1, 0], [0, 1], [0, -1],
  [1, 1], [-1, -1], [1, -1], [-1, 1]
];

// ----- クリック処理 -----
function handleClick(x, y) {
  if (board[y][x] !== null) return;

  // ひっくり返せる石
  const flipCells = getFlippableCells(x, y, currentPlayer);

  if (flipCells.length === 0) return; // 合法手でなければ無視

  // 石を置く
  board[y][x] = currentPlayer;

  // ひっくり返す
  for (const [fx, fy] of flipCells) {
    board[fy][fx] = currentPlayer;
  }

  // 手番交代
  currentPlayer = currentPlayer === "black" ? "white" : "black";

  drawBoard();
}

// ----- 石がひっくり返るマスを取得 -----
function getFlippableCells(x, y, player) {
  const opponent = player === "black" ? "white" : "black";
  let flippable = [];

  for (const [dx, dy] of directions) {
    let nx = x + dx;
    let ny = y + dy;
    let temp = [];

    while (
      ny >= 0 && ny < boardSize &&
      nx >= 0 && nx < boardSize &&
      board[ny][nx] === opponent
    ) {
      temp.push([nx, ny]);
      nx += dx;
      ny += dy;
    }

    if (
      ny >= 0 && ny < boardSize &&
      nx >= 0 && nx < boardSize &&
      board[ny][nx] === player &&
      temp.length > 0
    ) {
      flippable.push(...temp);
    }
  }
  return flippable;
}
</script>

</body>
</html>
